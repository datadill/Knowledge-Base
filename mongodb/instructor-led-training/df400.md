# DF400

## BSON

* Binary Serialized Object Notation
  * Cross language object -> binary -> object
  * Used internally and for network traffic
  * Converted to hash/dict objects in most drivers
  * Basically, a list of named, typed values:
    * Type, FieldName, \<length>, Data
    * Type, FieldName, \<length>, Data
      * \<length> will tell a program how many bytes to skip to get to the next field, which improves performance

### Arrays vs Documents

* The diffrence is in how they map to a programming lanugage and what constraints
  * Can only $push to an array, not to a document
  * Arrays can contain duplicates
  * Arrays cannot be sparse, must store nulls for empty values
* Large arrays or large flat documents are equally bad
  * Max 200 elements strongly recommended in either
    * Recall previous discussions about 200 element arrays
  * Large or unbounded arrays can have a significant speed impact
* Arrays are often used where document would be a better choice!



Ex.&#x20;

<figure><img src="../../.gitbook/assets/image (45).png" alt=""><figcaption></figcaption></figure>

* In the above, we redesigned the schema to be 30% smaller
* However, the way you query the 2nd result is significantly different
  * Furthermore, indexing the 2nd example is very difficult
    * In the first example, you could index Results.Player

### When to Use Arrays

* Use arrays when:
  * Just need to $push to the end
  * Don't have unique identifiers&#x20;
  * Having sparse data is not an issue
  * Need to index the values to search them
* Otherwise, consider objects
  * Projection is faster than $filter
  * Querying a single member is faster
* One big advantage of arrays over joined tables i not needing an indexed (foreign) key for each element



## Document model vs Relational

<figure><img src="../../.gitbook/assets/image (46).png" alt=""><figcaption></figcaption></figure>



## Histogram Exercise

<figure><img src="../../.gitbook/assets/image (47).png" alt=""><figcaption></figcaption></figure>

* 24 hrs x 60 minutes gets you 1440
* The question is, do you have a single array with 1440 elements or do a 2 dimensional array:

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

* In regards to updating, one of the above will be significantly faster...
  * In the 1440 element array, on average, you will have to scan 720 places before finding the value you need
  * By switching to a 2 dimensional array, that number is 360

## Schema Design in MongoDB

3 Considerations:

* The data the application needs
* Application's read usage of the data
* Application's write usage of the data



### Document Design Basics

* To link or embed?
  * Do I want the embedded info a lot of the time?
    * Put it in the same collection!
  * Do I need to search with the embedded info?
  * Does the embedded info change often?
  * Do I need the latest version or the same versions?
  * Is the embedded info shared - really?

